{% extends 'base.html' %}

{% block content %}
{% load static%}
{% load custom_filters %}
{% block style %} <style>
    .image-slider img {
        display: none;
    }

    /* Show the first image immediately when the page loads */
    .image-slider img:first-child {
        display: block;
    }
    
</style> {%endblock%}

    <!-- ***** Main Banner Area Start ***** -->
    {% for banner in banners  %}
    <div class="page-heading" id="top" style="background-image: url({{banner.image.url}});">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="inner-content">
                        <h2>Check Our Products</h2>
                        <span>Awesome &amp; Amazing</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <!-- ***** Main Banner Area End ***** -->


    <!-- ***** Products Area Starts ***** -->
    
        
        <section class="section" id="products" style="overflow: hidden;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-heading">
                        <h2>Our Latest Products</h2>
                       
                       
                        <span>Check out all of our products.</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
        <div class="col-lg-3">
        <div class="container mt-4">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="row d-flex justify-content-between mb-3">
            
                            <!-- Search Box -->
                            <div class="col-12">
                                <form action="{% url 'list_product_search' %}" method="GET">
                                    {% csrf_token %}
                                    <div class="input-group">
                                        <input type="text" name="query" id="query" class="form-control" placeholder="Search...">
                                        <div class="input-group-append">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fa fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
            
                            <!-- Price Filter Dropdown -->
                            <div class="col-12 mt-3">
                                <form id="filterForm" method="get" action="{% url 'product_filter' %}">
                                    {% csrf_token %}
            
                                    <div class="form-group">
                                        <label for="priceFilter">Price Filter:</label>
                                        <select id="priceFilter" name="priceFilterQuery" class="form-control">
                                            <option value=""></option>
                                            <option {% if sort == "lh" %} selected {%else%}{%endif%} value="lh">Price Low to High</option>
                                            <option {% if sort == "0-hl" %} selected {%else%}{%endif%} value="hl">Price High to Low</option>
                                        </select>
                                    </div>
            
                                    <div class="form-group">
                                        <label for="catFilter">Category Filter:</label>
                                        <select id="catFilter" name="catFilterQuery" class="form-control">
                                            {% for cat in category %}
                                                <option value="" hidden></option>
                                                <option {% if cate == cat.name %} selected {%else%}{%endif%} value="{{cat.name}}">{{cat.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
            
                                    <div class="form-group">
                                        <label for="priceRange">Price Range:</label>
                                        <select name="priceRange" id="priceRange" class="form-control">
                                            <option value="" hidden></option>
                                            <option {% if range == "0-50" %} selected {%else%}{%endif%} value="0-50">Rs.0 - Rs.50</option>
                                            <option {% if range == "51-100" %} selected {%else%}{%endif%} value="51-100">Rs.51 - Rs.100</option>
                                            <option {% if range == "101-500" %} selected {%else%}{%endif%} value="101-500">Rs.101 - Rs.500</option>
                                            <option {% if range == "501-1000" %} selected {%else%}{%endif%} value="501-1000">Rs.501 - Rs.1000</option>
                                            <option {% if range == "1001-5000" %} selected {%else%}{%endif%}  value="1001-5000">Rs.1001 - Rs.5000</option>
                                            <option {% if range == "5001-10000" %} selected {%else%}{%endif%} value="5001-10000">Rs.5001 - Rs.10000</option>
                                        </select>
                                    </div>
            
                                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                                </form>
                            </div>
            
                        </div>
                    </div>
                </div>
            </div>
            
        
            
        </div>
        </div>
        
       <div class="col-lg-9">
        <div class="container">
            <div class="row">
                {% for product in products %}
                <div class="col-lg-4">
                    <div class="item">
                        <div class="thumb">
                            <div class="hover-content">
                                <ul>
                                    <li><a href="{% url 'single_product' product_id=product.id %}"><i class="fa fa-eye"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                                    <!-- <li><a href="{% url 'add_to_cart' %}"><i class="fa fa-shopping-cart"></i></a></li> -->
                                </ul>
                            </div>
                           <!-- product_detail.html -->

                          <!-- product_detail.html -->

                          <div id="image-slider" class="image-slider">
                            
                            {% for variant in product.color.all %}
                                <img src="{{ variant.main_image.url }}" alt="" class="slider-image{{product.id}} animation" width="70px" height="300px">
                                {% endfor %}
                        </div>
                        
                        <script>
                            $(document).ready(function() {
                                var images = $('.slider-image{{product.id}}');
                        
                                // Check if there is more than one image
                                if (images.length > 1) {
                                    var currentIndex = 0;
                        
                                    function showNextImage() {
                                        images.eq(currentIndex).fadeOut(1000, function() {
                                            currentIndex = (currentIndex + 1) % images.length;
                                            images.eq(currentIndex).fadeIn(1000);
                                        });
                                    }
                        
                                    // Start the slideshow after a short delay
                                    setTimeout(function() {
                                        setInterval(showNextImage, 5000); // Switch image every 5 seconds after the initial display
                                    }, 50);
                                }
                            });
                        </script>
                        

                        </div>
                        <div class="down-content">
                            <h4>{{ product.name }}</h4>

                            {% load custom_filters %}

                            {% if product.get_default_product.discount %}
                                {% with original_price=product.get_smallest_price %}
                                    <span><strike>Rs. {{ original_price }}</strike> -{{ product.get_default_product.discount.disc_value }}%</span>
                                    <strong>Rs. {{ original_price|apply_discount:product.get_default_product.discount }} </strong>
                                {% endwith %}
                            {% elif parent_variant.discount %}
                                {% with original_price=product.get_smallest_price %}
                                    <span><strike>Rs. {{ original_price }}</strike> -{{ parent_variant.discount.disc_value }}%</span>
                                    <strong> Rs.{{ original_price|apply_discount:parent_variant.discount }} </strong>
                                {% endwith %}
                            {% elif product.discount %}
                                {% with original_price=product.get_smallest_price %}
                                    <span><strike>Rs. {{ original_price }}</strike> -{{ product.discount.disc_value }}% </span>
                                    <strong> Rs.{{ original_price|apply_discount:product.discount }} </strong>
                                {% endwith %}
                            {% elif product.category.discount %}
                                {% with original_price=product.get_smallest_price %}
                                    <span><strike>Rs. {{ original_price }}</strike> -{{ product.category.discount.disc_value }}% </span>
                                    <strong> Rs.{{ original_price|apply_discount:product.category.discount }} </strong>
                                {% endwith %}
                            {% else %}
                                <strong> Rs. {{ product.get_smallest_price }} </strong>
                            {% endif %}
                            
                            
                          
                            
            
                        

                            {% if product.avg_rating %}
                                <ul>
                                  
                                    <li>
                                      
                                        {% for star in product.avg_rating|stars %}
                                            {% if star == 1 %}
                                                <i class="fa fa-star"></i>
                                            {% elif star == 0.5 %}
                                                <i class="fa fa-star-half-alt"></i>
                                            {% else %}
                                                <i class="fa fa-star-o"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </li>
                                </ul>
                            {% else %}
                                <p>No ratings yet for this product.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
            
                <div class="col-lg-12">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            {% if products.has_previous %}
                                <li class="page-item">
                                    <a class="page-link " href="?page=1" aria-label="First">
                                        <span aria-hidden="true">&laquo;&laquo;</span>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ products.previous_page_number }}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                            {% endif %}
            
                            {% for page in products.paginator.page_range %}
                                <li class="page-item{% if page == products.number %} active{% endif %}">
                                    <a class="page-link text-dark" href="?page={{ page }}">{{ page }}</a>
                                </li>
                            {% endfor %}
            
                            {% if products.has_next %}
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page={{ products.next_page_number }}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link text-dark" href="?page={{ products.paginator.num_pages }}" aria-label="Last">
                                        <span aria-hidden="true">&raquo;&raquo;</span>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>
            
        </div>
    </div>
</div>
    </section>
    <!-- ***** Products Area Ends ***** -->
   
    


   {% endblock %}